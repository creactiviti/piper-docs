<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta name="author" content="CJ Patoilo">
		<meta name="description" content="a minimal workflow engine designed to be dead simple.">
		<title>Piper | A minimalist workflow engine.</title>
		<!-- <link rel="icon" href="https://milligram.github.io/images/icon.png"> -->
		<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300italic,700,700italic">
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/3.0.3/normalize.css">
		<link rel="stylesheet" href="css/milligram.min.css">
		<link rel="stylesheet" href="https://milligram.github.io/styles/main.css">
	</head>
	<body>

		<main class="wrapper">

			<nav class="navigation">
				<section class="container">
						<h1 class="title">Piper</h1>
				</section>
			</nav>

			<section class="container" id="introduction">
				<h5 class="title"><strong>Introduction</strong></h5>
				<p>Piper is a distributed workflow engine designed to be dead simple.</p>
				<h5 class="title"><strong>How does it work?</strong></h5>				
				<p>In Piper, work to be done is defined as a set of tasks called a Pipeline. 
				Pipelines can be sourced from many locations but typically they live on a Git repository where they can be versioned and tracked.</p>
				<p>Here's an example of a very simple pipeline:</p>
				<pre><code>name: Hello Demo

input: // this defines the input which the pipeline is expecting
  - name: yourName
    label: Your Name
    type: string
    required: true

tasks:
  - name: randomNumber
    label: Generate a random number
    type: randomInt
    startInclusive: 0
    endInclusive: 10000

  - label: Print a greeting
    type: print
    text: Hello ${yourName}

  - label: Sleep a little
    type: sleep
    millis: ${randomNumber} // tasks may refer to the result of a previous task

  - label: Print a farewell
    type: print
    text: Goodbye ${yourName}
				</code></pre>
				<h5 class="title"><strong>Start a Job</strong></h5>
				<p>URL:</p>
				<p>
				  <code>POST /jobs/start</code>
				</p>
				<p>Body:</p>
<pre><code>{
  "pipeline": "demo/hello",
  "yourName": "Arik"
}
</code></pre>
<p>Response:</p>
<pre>
<code>
{
  "name": "Hello Demo",
  "currentTask": 0,
  "id": "396ab4b863244dd5bf376813d94f9932",
  "creationDate": "2017-04-03T06:01:51+0000",
  "startDate": "2017-04-03T06:01:51+0000",
  "pipelineId": "demo/hello:7b911fe",
  "status": "STARTED"
}
</code>
</pre>
<h5 class="title"><strong>Check Job Status</strong></h5>
<p>URL:</p>
<p>
  <code>GET /jobs/{JOB ID}</code>
</p>
<p>Response:</p>
<pre>
<code>
{
  "id": "396ab4b863244dd5bf376813d94f9932",
  "name": "Hello Demo",
  "pipelineId": "demo/hello:7b911fe",
  "status": "COMPLETED",
  "completionDate": "2017-04-03T06:02:01+0000",
  "creationDate": "2017-04-03T06:01:51+0000",
  "startDate": "2017-04-03T06:01:51+0000"
  "execution": [
    {
      "startInclusive": 0,
      "label": "Generate a random number",
      "type": "randomInt",
      "creationDate": "2017-04-03T06:01:51+0000",
      "output": 8495,
      "jobId": "396ab4b863244dd5bf376813d94f9932",
      "name": "randomNumber",
      "endInclusive": 10000,
      "completionDate": "2017-04-03T06:01:51+0000",
      "taskNumber": 0,
      "id": "fbd8bdaa63b54ffeb4c928ceb04de48a",
      "status": "COMPLETED"
    },
    ...
  ]
}
</code>
</pre>
				<h5 class="title"><strong>Architecture</strong></h5>
				<p>Piper is based on a Coordinator/Worker model.</p>
				
				<p>The <strong>Coordinator</strong> is the component responsible for accepting jobs to be executed, for distributing the tasks to workers through queues
				and for generally keeping track on where jobs are at.</p>
				
				<p>The <strong>Worker</strong> on the other hand is not aware of jobs as such and is only responsible for executing a single task given to it
				by the Coordinator. When a Worker is done with the task, it sends a message to the Coordinator &mdash; reporting the completion. The Coordinator then picks up
				the overall job associated with that task and dolls out the next task to be done to a Worker until the job is completed.</p>
				
				<p>The Coordinator and workers do not talk to each other directly. Instead a <strong>Messaging Queue Broker</strong> is used between them to talk. 
				Workers subsctibe to the various work queues by their types to recieve work. This allows Piper to scale horizontally by simply adding more workers as the work
				load increases.</p>
<pre>

    +-------------+ 
    |             | 
    |  Database   | 
    |             |           
    +-------------+
      
           ^      
    +-------------+      +--------+      +--------+ 
    |             |      |        |      |        |
    | Coordinator | <--> | Broker | <--> | Worker |
    |             |      |        |      |        |
    +-------------+      +--------+      +--------+
    
    
</pre>
			</section>
			
			<footer class="footer">
			  <section class="container">
				<p>Designed with â™¥ by<a href="http://creactiviti.com" title="Arik Cohen" target="_blank"> creactiviti</a>.</p>
			  </section>
			</footer>

		</main>

		<script src="https://milligram.github.io/scripts/main.js"></script>

	</body>
</html>
